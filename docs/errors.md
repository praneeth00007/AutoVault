# AutoVault ‚Äî Troubleshooting & Error Log

This document records common issues encountered during the development of **AutoVault** and explains **why they occur** and **how they were resolved**.
The goal is to help developers debug iExec TEE applications efficiently and avoid common misconceptions.

---

## üö® 1. Docker Error: `failed to resolve reference` / `TLS handshake timeout`

**Symptom**
`iapp test` or `iapp deploy` fails during the Docker image pull stage.

**Cause**
Temporary network issues or a stalled Docker daemon while pulling base images from Docker Hub.

**Resolution**

* Verify internet connectivity.
* Restart Docker Desktop / Docker daemon.
* Manually test the pull:

  ```bash
  docker pull python:3.13-alpine  # or your specific base image
  ```

---

## üö® 2. `Failed to transform your app into a TEE app: Internal error`

**Symptom**
Deployment fails during the TEE transformation phase.

**Cause**

* Unsupported or incompatible base image in the `Dockerfile`.
* Mismatch between `iexec.json` and the expected iApp project structure.
* Corrupted local build cache.

**Resolution**

* Revert to a known-compatible iApp base image.
* Ensure `iexec.json` matches the project layout generated by the `iapp` CLI. 
* Redeploy:

  ```bash
  iapp deploy --tee
  ```

---

## üö® 3. Task status: `INITIALIZE_FAILED` (TEE Enclave)

**Symptom**
The task fails almost immediately after being scheduled, with status `INITIALIZE_FAILED`.

**Cause**
The TEE enclave failed to initialize **before user code execution**.
This indicates that the deployed iApp configuration is incompatible with the available TEE workers.

**Resolution**

* Redeploy the iApp using a configuration compatible with the target network‚Äôs TEE workers.
* Confirm the app was deployed as a TEE app and includes valid enclave metadata.
* Verify app details:

  ```bash
  iexec app show <APP_ADDRESS>
  ```

---

## üö® 4. Execution hangs at `REQUEST_TO_PROCESS_PROTECTED_DATA`

**Symptom**
The frontend submits the execution request, but the task remains pending and never progresses.

**Cause**
The request was accepted, but no compatible workerpool picked up the task.
On test networks, this can occur due to:

* Limited worker availability
* Implicit matchmaking selecting an inactive or incompatible workerpool

**Resolution**

* Explicitly specify a known TEE-capable workerpool address in your frontend configuration.
* Ensure execution pricing constraints match existing marketplace orders.

---

## üö® 5. `TypeError: dataProtector.protectData is not a function`

**Symptom**
The frontend crashes during the data protection step.

**Cause**
Incorrect initialization or usage of the `@iexec/dataprotector` SDK.

**Resolution**
Initialize and use the SDK correctly:

```ts
const dp = new IExecDataProtector(provider);
await dp.core.protectData(...);
```

---

## üö® 6. `result.json` not found in enclave output

**Symptom**
The task completes successfully, but the frontend cannot find `result.json`.

**Cause**

* The application did not write output to `/iexec_out/`.
* The expected output path does not match the runtime configuration.

**Resolution**

* Ensure the app writes results to:

  ```python
  /iexec_out/result.json
  ```
* Verify output path configuration if used by the runtime.

---

---

## üö® 7. `DETERMINISM_HASH_NOT_FOUND`

**Symptom**
The task fails on-chain with the error `DETERMINISM_HASH_NOT_FOUND` after deployment, even though local testing with mock data passed.

**Cause**
This is a generic error that occurs when the TEE enclave fails to produce a valid result hash. Common reasons include:
* **Missing Output**: The application did not write `result.json` to `/iexec_out/`.
* **Enclave Runtime Failure**: The process crashed due to environment differences (e.g., missing dependencies in the TEE image).
* **Timeout**: The computation took too long and was killed by the worker.
* **Non-deterministic Logic**: Using external network calls or non-deterministic libraries that cause the enclave to abort.

**Resolution**
* Review `IAPP/README.md` to ensure all dependencies are correctly bundled in the Docker image.
* Verify that your application writes exactly one `result.json` to `/iexec_out/`.
* Increase the task category or timeout settings if the computation is heavy.
* Ensure no network calls or non-deterministic operations (like `time.now()` without a seed) are used in the core logic.

---

## üö® 8. Task marked `COMPLETED` but frontend reports ‚ÄúTask not found‚Äù

**Symptom**
CLI reports task completion, but the frontend cannot retrieve results.

**Cause**
Network configuration mismatch between frontend and CLI tools.

**Resolution**

* Verify that all configuration files are set to the same network (e.g., Arbitrum Sepolia).
* Ensure the frontend provider is connected to the correct chain.

---

## üö® 8. Lost Task ID after page refresh

**Symptom**
Users lose execution progress when the page is refreshed during a long-running task.

**Cause**
The task identifier is held only in memory and not persisted.

**Resolution**

* Capture the `taskId` during execution status updates.
* Persist it (e.g., `localStorage`) to allow session recovery.

---

## üõ†Ô∏è Useful Debugging Commands

When working inside the `AutoVault/IAPP` directory:

### Check Deal Status

```bash
iexec deal show <DEAL_ID>
```

### Deep Task Debugging

```bash
iexec task debug <TASK_ID>
```

### Task Summary

```bash
iexec task show <TASK_ID>
```

---

## üìå Common Misconceptions

* Worker selection cannot fix enclave initialization failures.
* TEE issues often originate from **deployment-time configuration**, not runtime logic.
* Testnet environments may have limited or unstable worker availability.

---

*This document reflects real issues encountered during development of AutoVault and is intended as a practical reference for building confidential ABS applications.*
